<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
        integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
    <script src="https://cdn.osmbuildings.org/classic/0.2.2b/OSMBuildings-Leaflet.js"></script>
    <script type="text/javascript" src="Dependencies/Census_Visualization/grpc_querier.bundle.js"></script>
    <script type="text/javascript" src="Dependencies/Census_Visualization/census_visualizer.js"></script>
    <link rel="stylesheet" type="text/css" href="IframeStyle.css">
</head>
<body>
    <!--Required for this map to be controlled-->
    <script>const MAPNUMBER = 3; //refers to whatever map in the grid this refers to</script>
    <script src="Dependencies/mouseDown.js"></script>
    <script>thisMapNumber=MAPNUMBER; //changes a variable in the mouseDown.js script</script>
    <!------------------------------------------>
    <div id='map3' class='map'>
    </div>
    <script>
        var buildingmap = new L.Map('map3');
        buildingmap.setView(parent.view, 10, false);

        new L.TileLayer('https://api.mapbox.com/styles/v1/osmbuildings/cjt9gq35s09051fo7urho3m0f/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoib3NtYnVpbGRpbmdzIiwiYSI6IjNldU0tNDAifQ.c5EU_3V8b87xO24tuWil0w', {
          attribution: 'Â© Map tiles <a href="https://mapbox.com">Mapbox</a>',
          maxZoom: 18,
          maxNativeZoom: 20
        }).addTo(buildingmap);

        var osmb = new OSMBuildings(buildingmap).load('https://{s}.data.osmbuildings.org/0.2/anonymous/tile/{z}/{x}/{y}.json');

        const censusViz = census_visualizer();
        censusViz.updateViz(buildingmap);

        //updates controller----------------------------------------------
        buildingmap.on("move", function () {
            parent.setGlobalPosition(buildingmap.getCenter(),MAPNUMBER);
        });
        buildingmap.on("zoomend", function () {
            parent.setGlobalPositionFORCE(buildingmap.getCenter(),MAPNUMBER);
        });
        buildingmap.on("moveend", function () {
            censusViz.updateViz(buildingmap);
        });
        //----------------------------------------------------------------
    </script>

    <!--You must add this map's setter function-->
    <script>
    var thisMapsSetter = function(view,zoom){
        if(view.lng < 0)
            view.lng += 360;
        buildingmap.setView(view, buildingmap.getZoom());
        censusViz.updateViz(buildingmap);
    }
        parent.setterFunctions.push({
            setterFunc: thisMapsSetter,
            mapNum: MAPNUMBER
        });
    </script>
</body>
