<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
        integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
    <link rel="stylesheet" type="text/css" href="IframeStyle.css">
    <link rel="stylesheet" type="text/css" href="Dependencies/OverPassLayer.css">
    <script src="Dependencies/OverPassLayer.bundle.js"></script>
</head>
<body>
    <!--Required for this map to be controlled-->
    <script>const MAPNUMBER = 2; //refers to whatever map in the grid this refers to</script>
    <script src="Dependencies/mouseDown.js"></script>
    <script>thisMapNumber=MAPNUMBER; //changes a variable in the mouseDown.js script</script>
    <!------------------------------------------>

    <div id='map2' class='map'></div>
    <script>
        osmMap2 = L.map('map2', {renderer: L.canvas(), minZoom: 3, 
            fullscreenControl: true,
            inertia: false,
            timeDimension: false
        }).setView(parent.view, parent.zoomLevel);

        var tiles2 = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18,
            maxBounds: [[],[]]
        }).addTo(osmMap2);

        
        L.icon = function (options) {
			return new L.Icon({
				iconUrl: "../../images/drinking_fountain.png",
				iconSize: [25, 25]
			});
		};

		
		function getNewOverPassLayer(query){
			return new L.OverPassLayer({
						minZoom: 14,
						query: query,
						markerIcon: L.icon()
					});
		}

        var opl = getNewOverPassLayer('node [amenity=drinking_water] ({{bbox}}); out;')
		osmMap2.addLayer(opl);

        osmMap2.on("move", function () {
            parent.setGlobalPosition(osmMap2.getCenter(),2);
            parent.setGlobalZoom(osmMap2.getZoom(),2);
        });
        
        // Only one query per layer - we must remove and re-add layer to get output for new location
        function updateOverPassLayer(opl, e){
	    if(e.target.getZoom() < opl.options.minZoom) { return opl } //ignore when results not visible to reduce requests
	    osmMap2.removeLayer(opl)
            opl = getNewOverPassLayer('node [amenity=drinking_water] ({{bbox}}); out;')
		osmMap2.addLayer(opl);
		return opl
	    }
		
		// To stop the map from crashing when zooming out from places with many icons
        function removeOverPassLayer(opl, e){
            osmMap2.removeLayer(opl)
	}
        
        osmMap2.on("moveend", function (e) {
	    opl = updateOverPassLayer(opl, e)
        });
        
    </script>

    <!--You must add this map's setter function-->
    <script> 
        var thisMapsSetter = function(view,zoom){
            osmMap2.setView(view, osmMap2.getZoom());
        }
        parent.setterFunctions.push(thisMapsSetter);
    </script> 
</body>
